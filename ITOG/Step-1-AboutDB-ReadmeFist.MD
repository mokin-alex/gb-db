Курсовой проект: Базы данных.

За основу БД был взят сайта https://www.magnumphotos.com/shop/
Реализованы лишь следующие "ветки" этого сайта:
    - фотографы https://www.magnumphotos.com/photographers
    - магазин   https://www.magnumphotos.com/shop/
    - и "внутрення" - работа с заказыми, прайсы, обновления их и т.п.

1. Описание БД 
Имеются таблицы: профайлом фотографа photographers, фотографий из его портфолио - photos, его социальных сетей - social_channels
Имеются таблицы: с коллекцией магазина - collections (принты, постеры, книги и др), с различными вариантами исполения, они могут быть подписаны автором, или штампом владельца, входить в ту или иную редакцию, различаться по количеству,размеру и цене - эти различия можно найти в таблице price
Экзепляр коллекции так же может иметь несколько фотографий для отображения - coll_photos, может иметь несколько строк спецификации из таблицы coll_specification
Имеются таблицы: заказов - orders, позиции продукции в заказе order_products заказанные по цене из таблицы price
А так же покупатели из таблицы users, которым соответсуют заказы.

Имеются так же таблицы для планирования изменения цены и лимитов продукции - planned_price и planned_limit, в которой указана дата будущего изменения прайса или лимита, обновление прайса выполняет хранимая процедура в соответсвии с Событиями БД, логирование изменеий (триггеры) ведется в АРХИВНОЙ таблице price_history

Имеются Представления.

ЧТО РЕАЛИЗОВАНО:

2. Можно посмотреть картинки, где указаны соответсвие полей таблиц и сайта
    Step-2-1-photographers.png - соответсвующие таблицы Фоторграфы и связанные таблицы
    Step-2-2-collections-1.png - коллекция и связанные таблицы
    Step-2-2-collections-2.png 

3. Создание структуры БД
    Step-3-create_tables.sql
    Создание таблиц, первичных индексов, индексов, внешних ключей, подробные комментарии таблицам и их полям.

4. Создана ERDiagram для БД
    Step-4-0-ERDiagramScreen.png - диаграмма и структура БД слева
    Step-4-1-ERDiagram.png       - просто диаграмма
    Step-4-2-ERDiagramDetailBIG.png - более детальная и крупная диаграмма
    
5. Скрипты наполнения БД данными.
   5.1 Генерация первоначальных данных осуществлялась с помощью сервиса https://mockaroo.com/
    Step-5-0-mockaroo.png - отображены сконструированные для этого схемы данных schemas и datasets
    Step-5-1-data_loader - Каталог, которые содержит:
        datasets - из которых берется часть данных для генерации, так например ИМЕНА ФОТОГРАФОВ РЕАЛЬНЫЕ, взяты с сайта.
        schema.json - файлы с типми данных и формулами их генерации, можно использовать повторно, если импортировать в сервис mockaroo
        coll_photos.schema (1).json - например для генерации фото для колекции продукции магазина.
        *.sql - файлы для непосредственно добавления данных в уже созданные табдицы БД 
        
    5.2 Исправление части данных после случайной генерации, приведение БД к более реальным данным.
     Step-5-2-UpdateDataToRealLife.sql - имеются комментарии
     (иногда используюся "хитры" запросы)
     
6. Типичные запросы на выборку:
    Step-6-typical_select.sql - ЗАПРОСЫ С комментариями 
    
    и РЕЗУЛЬТАТАМИ! (там же)
    
    Получилось 5 запросов, в которых использовались: вложенные запросы, join,  группировка, case и if, агрегирующие функции и сортировка.

    -- Запрос 1: Рейтинг авторов
        -- сколько фото представлено на сайте в портфолио
        -- сколько продукции (фото, постеры, книги) в магазине
        -- сколько реально в штуках преобретено, и на какую общую сумму
    -- Запрос 2: Рейтинг покупателей
        -- сколько заказов в статусе оплачен и доставлен
        -- сколько позиций и на какую сумму
        -- дата последнего из заказов 
    -- Запрос 3: Анти Рейтинг покупателей, которые отказались от заказов 
    -- Запрос 4: Информация о заказах
        -- отсортированных по дате, с общей суммой и количеством позиций в заказе, статус заказа.
    -- Запрос 5: Какая продукция более всего заказывалась
        -- в разрезе Типа(фото, постер,книга,предмет), подтипа(раритетная книга или винтажный постер), колекция магнум,    подписанли или штам владельца.
        -- использовались: вложенный запрос, join,  группировка, case и if, агрегирующие функции.

7. Созданы Представления VIEWS
    Step-7-create_views.sql -- Это файл создания Представлений, с комментариями
    
    7.1 -- Представление на странице каталога для постеров: https://www.magnumphotos.com/shop/collections/posters/
    7.2 -- Представление на странице каталога (то же самое), но для, например, Книг: https://www.magnumphotos.com/shop/collections/books/    

     7.3 Это Представление уже самого продукта, например,из категории Fine Prints:
     https://www.magnumphotos.com/shop/collections/magnum-editions/magnum-editions-elizabeth-taylor-on-the-set-of-suddenly-last-sunmmer-1959/
    Особенность лишь в том что в колонке Спецификация использую group_concat для того что бы в одной колонке разместить несколько строк из другой таблицы coll_specification
    Получится такая спецификация в одном поле:
    Age: Printed 2008
    Digital Fibre Print
    Edition of 100
    Estate Stamped on recto
    
    
8. Созданы триггеры, хранимые процедуры и события.
    8.1 Создание триггеров.
    Step-8-1-create_triggers.sql - содержит комментарии и результаты выполнения
    
    * В триггере №1 использовали значение OLD.tbl_name и исключения signal sqlstate для блокировки операции удаления.
    * В триггере №2 использовали значение NEW.tbl_name для логирования новых важных значений в позиции товара (price).
    * В триггере №3 использовали внутреннюю переменную txt, в которую соединяли (concat) названия "изменившихся" значений колонок перед операцией update.
    *   Так же используется оператор Null-безопасное сравнение, так как поля могут измениться с/на значение null.  
    
    * Все три триггера логировали инфо в таблицу АРХИВНОГО типа price_history, в колонке info - информации о произошедшем событии и наименованиях колонок подвергшиеся изменениям. 
    
    8.2 Создание хранимой процедуры (с транзакциями)
    Step-8-2-create_procedure.sql - содержит комментарии и результаты выполнения
    
    Процедура выполняет обновление таблицы price в соответсвии с планом в таблице planned_price, если плановая дата равна текущей, и меняет статус в плане как выполненая,
    обе операции - обновление прайса и обновление статуса в плане выполняются как одна транзакция, в случае ошибки - будет откат транзакции.

    8.3. Создание События
    Step-8-3-create_event.sql - содержит комментарии и результаты выполнения
    
    Запуск по расписанию процедуры обновления прайсов и лимитов из плановых таблиц
    
9. Выгружен дамп БД в каталог Step-9-sql_dump
    Причем для корректной загрузки исключены теги DEFINER, для корректной загрузки Представлений, Процедур и Событий.
    А так же в таблице price_history в строке
    ) ENGINE=ARCHIVE AUTO_INCREMENT=17
    исправлено на строку
    ) ENGINE=ARCHIVE AUTO_INCREMENT=0
    иначе при загрузке значений архивной таблицы будет ошибка дублирования ключей.
    
    dump-mawmagnum23-202009231544-.sql - готовый для загрузки дамп (см.выше)
    
    ВАжно восстанавливать клиентом mysql.exe 8-ой версии:
    E:\OpenServer\modules\database\MySQL-8.0\bin\mysql.exe --host=localhost --port=3306 -u 
    (иначе может быть не восстановлена полностью)
    
    +
    dump-mawmagnum23-not-ready-to-load.sql - дамп "как есть" mysqldump, на всякий случай. (см.выше)
    
    
    
    
    
    


    




    

   


    






